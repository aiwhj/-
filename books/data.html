<!DOCTYPE html>
<html lang="en"><head>
<title>永豪图书管理系统</title><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/bootstrap-responsive.min.css">
<link rel="stylesheet" href="css/fullcalendar.css">
<link rel="stylesheet" href="css/maruti-style.css">
<link rel="stylesheet" href="css/maruti-media.css" class="skin-color">
<link rel="stylesheet" href="css/uniform.css">
<link rel="stylesheet" href="css/select2.css">
</head>
<body id="table-data">
<div id="header">
  <h1><a href="/">永豪图书管理系统</a></h1>
</div>
<div class="btn-group rightzero"> <a class="top_message tip-left" data-original-title="Manage Files"><i class="icon-file"></i></a> <a class="top_message tip-bottom" data-original-title="Manage Users"><i class="icon-user"></i></a> <a class="top_message tip-bottom" data-original-title="Manage Comments"><i class="icon-comment"></i><span class="label label-important">5</span></a> <a class="top_message tip-bottom" data-original-title="Manage Orders"><i class="icon-shopping-cart"></i></a> </div>
<div id="user-nav" class="navbar navbar-inverse">
  <ul class="nav">
    <li class=""><a title="" href="data.html"><i class="icon icon-signal"></i> <span class="text">报表</span></a></li>
    <!-- <li class=""><a title="" href="setting.html"><i class="icon icon-cog"></i> <span class="text">设置</span></a></li> -->
    <li class=""><a title="退出" href="#" id="quit"><i class="icon icon-off"></i> <span class="text">退出</span></a></li>
  </ul>
</div>
<div id="sidebar"><a href="#" class="visible-phone"><i class="icon icon-home"></i> 已租图书  </a>
  <ul style="display: block;">
    <li class="active"><a href="index.html"><i class="icon icon-star"></i> <span>已租图书</span></a></li>
    <li> <a href="sells.html"><i class="icon icon-leaf"></i> <span>销售历史</span></a> </li>
    <li> <a href="users.html"><i class="icon icon-user"></i> <span>会员列表</span></a> </li>
    <li><a href="books.html"><i class="icon icon-book"></i> <span>图书仓库</span></a></li>
    <li><a href="rerents.html"><i class="icon icon-ok"></i> <span>已还历史</span></a></li>
  </ul>
</div>
<div id="content">
  <div id="content-header">
	<div class="widget-box widget-plain">
		<div class="center">
			<ul class="stat-boxes stat-boxes2">
			  <li>
				<div class="right" id="sell_data"> <strong>486.60元/4次</strong>销售总额 </div>
			  </li>
			  <li>
				<div class="right" id="rent_data"> <strong>163本/20次</strong> 租赁总数 </div>
			  </li>
			  <li>
				<div class="right" id="user_data"> <strong>289.00元/2人</strong> 会员总数 </div>
			  </li>
			  <li>
				<div class="right" id="book_data"> <strong>59本/3种</strong> 图书总数 </div>
			  </li>
			</ul>
		</div>
	</div>
  </div>
  <div class="container-fluid">
	<div class="row-fluid">
		<div class="span6">
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon">
						<i class="icon-signal"></i>
					</span>
					<h5>销售额条形统计图</h5>
				</div>
				<div class="widget-content">
					<div class="bars_sell"></div>
				</div>
			</div>
		</div>
        <div class="span6">
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon">
						<i class="icon-signal"></i>
					</span>
					<h5>销售额饼状统计图</h5>
				</div>
				<div class="widget-content">
					<div class="pie_sell"></div>
				</div>
			</div>
		</div>
	</div>
	<div class="row-fluid">
		<div class="span6">
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon">
						<i class="icon-signal"></i>
					</span>
					<h5>租赁数条形统计图</h5>
				</div>
				<div class="widget-content">
					<div class="bars_rent"></div>
				</div>
			</div>
		</div>
        <div class="span6">
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon">
						<i class="icon-signal"></i>
					</span>
					<h5>租赁数饼状统计图</h5>
				</div>
				<div class="widget-content">
					<div class="pie_rent"></div>
				</div>
			</div>
		</div>
	</div>
	<div class="row-fluid">
		<div class="span6">
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon">
						<i class="icon-signal"></i>
					</span>
					<h5>会员数条形统计图</h5>
				</div>
				<div class="widget-content">
					<div class="bars_user"></div>
				</div>
			</div>
		</div>
        <div class="span6">
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon">
						<i class="icon-signal"></i>
					</span>
					<h5>会员数饼状统计图</h5>
				</div>
				<div class="widget-content">
					<div class="pie_user"></div>
				</div>
			</div>
		</div>
	</div>
	<div class="row-fluid">
		<div class="span6">
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon">
						<i class="icon-signal"></i>
					</span>
					<h5>图书数条形统计图</h5>
				</div>
				<div class="widget-content">
					<div class="bars_book"></div>
				</div>
			</div>
		</div>
        <div class="span6">
			<div class="widget-box">
				<div class="widget-title">
					<span class="icon">
						<i class="icon-signal"></i>
					</span>
					<h5>图书数饼状统计图</h5>
				</div>
				<div class="widget-content">
					<div class="pie_book"></div>
				</div>
			</div>
		</div>
	</div>
  </div>
</div>
<script src="js/jquery.min.js"></script> 
<script src="js/jquery.ui.custom.js"></script> 
<script src="js/bootstrap.min.js"></script> 
<script src="js/jquery.uniform.js"></script> 
<script src="js/select2.min.js"></script> 
<script src="js/jquery.dataTables.min.js"></script> 
<script src="js/jquery.json.js"></script> 
<script src="js/maruti.js"></script> 
<script src="js/vue.js"></script>
<script src="js/maruti.tables.js"></script>
<script src="js/excanvas.min.js"></script>
<script src="js/jquery.flot.min.js"></script>
<script src="js/jquery.flot.pie.min.js"></script>
<script src="js/jquery.flot.resize.min.js"></script>
<script src="js/jquery.peity.min.js"></script> 
<script src="js/maruti.charts.js"></script>
<script src="js/vue.book.comm.js"></script>
<script>
function getbars(where,data) {
	var d2=[];
	d2.push({
		data:data,
		bars: {
			show: true, 
			barWidth: 0.5, 
			order: 1,
		}
	});  
	var bar = $.plot($(where), d2, {
		legend: true
	});
}
function getpie(where,data){
    var pie = $.plot($(where), data,{
        series: {
            pie: {
                show: true,
                radius: 3/4,
                label: {
                    show: true,
                    radius: 3/4,
                    formatter: function(label, series){
                        return '<div style="font-size:8pt;text-align:center;padding:2px;color:white;">'+label+'<br/>'+Math.round(series.percent)+'%</div>';
                    },
                    background: {
                        opacity: 0.5,
                        color: '#000'
                    }
                },
                innerRadius: 0.2
            },
			legend: {
				show: false
			}
		}
	});
}
function setpie() {
	var piedata = [];
	DateTable.datas.sell.month.sell_money.forEach(function(value, index) { 
		DateTable.bars.push([index, value]);
		piedata[index] = { label: "月份"+(index+1)+"："+value+"元", data: parseInt(value) }
	});
	getbars(".bars_sell",DateTable.bars);
	getpie(".pie_sell",piedata);
	DateTable.bars=[];
	piedata = [];
	DateTable.datas.rent.month.rent_num.forEach(function(value, index) { 
		DateTable.bars.push([index, value]);
		piedata[index] = { label: "月份"+(index+1)+"："+parseInt(value)+"本", data: parseInt(value) }
	});
	getbars(".bars_rent",DateTable.bars);
	getpie(".pie_rent",piedata);
	DateTable.bars=[];
	piedata = [];
	DateTable.datas.user.month.user_count.forEach(function(value, index) { 
		DateTable.bars.push([index, value]);
		piedata[index] = { label: "月份"+(index+1)+"："+parseInt(value)+"人", data: parseInt(value) }
	});
	getbars(".bars_user",DateTable.bars);
	getpie(".pie_user",piedata);
	DateTable.bars=[];
	piedata = [];
	DateTable.datas.book.month.book_count.forEach(function(value, index) { 
		DateTable.bars.push([index, value]);
		piedata[index] = { label: "月份"+(index+1)+"："+parseInt(value)+"本", data: parseInt(value) }
	});
	getbars(".bars_book",DateTable.bars);
	getpie(".pie_book",piedata);
}
var page=1;
var DateTable = new Vue({
	el: '#table-data',
	data: {
		datas: '',
		bars:[],
		bardata: [],
		piedata:''
	},
	methods: {
		load: function() {
			var vm = this;
			vm.datas = '';
			$.ajax({
				url: 'http://myslim.whj.com/datas/datas',
				type: 'GET',
				success: function(data) {
					if(JSON.parse(data).status=='success') {
						if(JSON.parse(data).data=='') {
							alert("暂时没有数据");
						} else {
							vm.datas=JSON.parse(data).data;
							console.log("所有数据"+JSON.parse(data).data);
						}
					} else {
						alert("数据出错");
					}
					setpie();
				}
			})
		}
	}
})
DateTable.load();
$("#search-btn").click(function(){
	DateTable.search($("#ser").val(),$("#ser_type").val());
});
$("#data-refresh").click(function(){
	page=1;
	DateTable.load();
});
</script>


</body></html>